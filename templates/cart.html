<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="{{ url_for('static', filename='script.js') }}"></script>

<title>Warenkorb</title>
</head>
  
<body>
  {% include 'navbar.html' %}

<div id="navbar-placeholder"></div>

  


<body>
  <main style="margin-left: 100px">
  <h1 style="margin:50px">Warenkorb</h1>
  <div id="cart-items" style="padding:20px; font-size: 20px"></div>
 <div style="display: flex; align-items: center; justify-content: space-between; margin: 50px; max-width: 800px;">
  <h2>Zwischensumme: <span id="total-price">0.00</span> €</h2>
  <button id="checkout-btn" style="
    background-color: #ff7f50;
    color: #fff;
    font-weight: 700;
    font-size: 1.1rem;
    border: none;
    border-radius:5px;
    padding: 20px 150px;
    cursor: pointer;
    transition: background-color 0.3s ease;">Zur Kasse</button>
</div>

  </main>

  <script>
    function loadCart() {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let container = document.getElementById('cart-items');
      container.innerHTML = '';

      if (cart.length === 0) {
        container.innerHTML = '<p>Dein Warenkorb ist leer.</p>';
        document.getElementById('total-price').textContent = '0.00';
        return;
      }

      let total = 0;

      cart.forEach(item => {
        let itemTotal = item.price * item.quantity;
        total += itemTotal;

        let div = document.createElement('div');
        div.style.display = "flex";
        div.style.alignItems = "enter";
        div.style.gap = "20px";
        div.style.marginBottom = "20px";

        div.innerHTML = `
          <img src="${item.image}" alt="${item.title}" style="width:150px; height:150px; ">
          <div>
            ${item.price.toFixed(2)} € x ${item.quantity} = ${itemTotal.toFixed(2)} €
            
            <button onclick="removeFromCart('${item.title}')">Entfernen</button>
          </div>
        `;
        container.appendChild(div);
      });

      document.getElementById('total-price').textContent = total.toFixed(2);
    }

    // Muss außerhalb von loadCart sein, damit onclick es findet
    function removeFromCart(title) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart = cart.filter(item => item.title !== title);
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();

      if (window.opener) {
        window.opener.updateCartCount && window.opener.updateCartCount();
      }
    }

    window.onload = loadCart;

    document.getElementById('checkout-btn').addEventListener('click', () => {
      window.location.href = '/checkout';
    });
  </script>
</body>
</html>
